# Режим сбора данных

Сбор данных по умолчанию отключен. Включайте его только на управляемых устройствах при наличии явной политики/согласия.

## Где это настраивается

1. Политика teacher (рекомендуется)
- Откройте `Teacher UI -> AI Detection`.
- Переключите `Data Collection Mode` глобально.
- Настройте sample rate, retention и интервал.

2. Локальное переопределение на student (только admin)
- Откройте `Student UI -> Security / Monitoring`.
- Введите admin-пароль.
- Настройте локальное переопределение, если это разрешено политикой.

## Что сохраняется

Корневая директория:

`%ProgramData%\\Controledu\\Datasets\\dataset`

Ожидаемая структура:

- `raw/<student-id>/<timestamp>.jpg`
- `raw/<student-id>/<timestamp>.json` (метаданные + результат детектора)
- `labels/classification.csv`
- `splits/train.txt`, `splits/val.txt`, `splits/test.txt`

## Политика сэмплирования (MVP)

Агент сохраняет сэмпл только когда выполнены все условия:

- кадр изменился (`Stage A` сообщил об изменении),
- прошел минимальный интервал (`DataCollectionMinIntervalSeconds`),
- пройдена случайная проверка сэмплирования (`DataCollectionSampleRate`),
- режим включен.

## Политика хранения

- Автоочистка удаляет устаревшие raw-файлы старше `DataCollectionRetentionDays`.
- На пилоте держите retention коротким.

## Экспорт датасета / диагностики

Из Student UI (только admin):

- Используйте `Export diagnostics`.
- ZIP появляется в `%ProgramData%\\Controledu\\exports`.
- ZIP содержит логи + датасет + snapshot локальной БД (MVP-пакет диагностики).

## Чеклист приватности

Перед включением сбора:

1. Проверьте юридическое основание и согласие.
2. Минимизируйте срок хранения.
3. Ограничьте доступ к пути датасета на файловой системе.
4. Не выгружайте raw-данные во внешние системы без согласования.
5. При необходимости добавьте провайдер редактирования/маскирования перед широким запуском.

## Устранение неполадок

1. Файлы не собираются
- Убедитесь, что режим включен.
- Проверьте, что кадр меняется.
- Для теста увеличьте sample rate и уменьшите min interval.

2. Не создается экспортный ZIP
- Проверьте права записи в `%ProgramData%\\Controledu\\exports`.
- Проверьте логи student-приложения на ошибки экспорта.

3. Датасет слишком большой
- Уменьшите sample rate.
- Сократите retention.
- Храните только миниатюры (будущая опция политики).
